<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Twin City Simulation</title>
    <link rel="stylesheet" href="style.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <i class="fas fa-city"></i>
            <h1>Digital Twin City Simulation</h1>
        </div>
        <div class="header-right">
            <!-- Search Bar -->
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" class="search-input" id="search-input" placeholder="Search locations, nodes, amenities...">
                <div class="search-results" id="search-results"></div>
            </div>
            
            <!-- Theme Toggle -->
            <button class="theme-toggle" id="theme-toggle" title="Toggle Dark/Light Theme">
                <i class="fas fa-moon"></i>
                <i class="fas fa-sun"></i>
            </button>
            
            <span class="status-badge" id="status-badge">
                <i class="fas fa-circle"></i>
                <span id="status-text">Connecting...</span>
            </span>
            <span class="device-badge" id="device-badge">
                <i class="fas fa-microchip"></i>
                <span id="device-text">CPU</span>
            </span>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- System Status -->
            <div class="panel">
                <h3><i class="fas fa-server"></i> System Status</h3>
                <div class="status-grid">
                    <div class="status-item">
                        <span class="label">Model</span>
                        <span class="value" id="model-status">--</span>
                    </div>
                    <div class="status-item">
                        <span class="label">Graph</span>
                        <span class="value" id="graph-status">--</span>
                    </div>
                    <div class="status-item">
                        <span class="label">Nodes</span>
                        <span class="value" id="node-count">--</span>
                    </div>
                    <div class="status-item">
                        <span class="label">Edges</span>
                        <span class="value" id="edge-count">--</span>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="panel">
                <h3><i class="fas fa-sliders-h"></i> Controls</h3>
                
                <div class="control-group">
                    <label>CTM Simulation Model</label>
                    <div style="padding: 8px; background: rgba(46, 204, 113, 0.2); border-radius: 6px; font-size: 0.85rem; color: #2ecc71;">
                        <i class="fas fa-check-circle"></i> Cell Transmission Model Active
                    </div>
                </div>
                
                <div class="control-group">
                    <label>Visualization Layers</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="layer-roads" checked>
                            <span class="checkmark"></span>
                            Roads
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="layer-metro" checked>
                            <span class="checkmark"></span>
                            Metro Lines
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="layer-nodes" checked>
                            <span class="checkmark"></span>
                            Nodes
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="layer-amenities" checked>
                            <span class="checkmark"></span>
                            Amenities
                        </label>
                    </div>
                </div>

                <!-- Prediction Controls -->
                <div class="control-group">
                    <label>Traffic Prediction</label>
                    <button class="btn btn-success" id="predict-btn">
                        <i class="fas fa-brain"></i> Run Prediction
                    </button>
                    <button class="btn btn-primary" id="view-analysis-btn" style="display: none;">
                        <i class="fas fa-chart-line"></i> View Analysis
                    </button>
                    <button class="btn btn-secondary" id="reset-btn">
                        <i class="fas fa-undo"></i> Reset Simulation
                    </button>
                </div>

                <!-- CTM Controls -->
                <div class="control-group" id="ctm-controls">
                    <label>CTM Simulation</label>
                    <button class="btn btn-success" id="ctm-init-btn">
                        <i class="fas fa-play"></i> Initialize CTM
                    </button>
                    <button class="btn btn-primary" id="ctm-step-btn">
                        <i class="fas fa-step-forward"></i> Step (1 min)
                    </button>
                    <button class="btn btn-primary" id="ctm-run-btn">
                        <i class="fas fa-forward"></i> Run (10 steps)
                    </button>
                    <button class="btn btn-secondary" id="ctm-reset-btn">
                        <i class="fas fa-redo"></i> Reset CTM
                    </button>
                </div>
                
                <div class="control-group" id="ctm-stats">
                    <label>CTM Status</label>
                    <div class="status-item">
                        <span class="label">Time</span>
                        <span class="value" id="ctm-time">0 min</span>
                    </div>
                    <div class="status-item">
                        <span class="label">Vehicles</span>
                        <span class="value" id="ctm-vehicles">0</span>
                    </div>
                    <div class="status-item">
                        <span class="label">Avg Density</span>
                        <span class="value" id="ctm-density">0%</span>
                    </div>
                </div>
            </div>

            <!-- Route Planner (NEW!) -->
            <div class="panel">
                <h3><i class="fas fa-route"></i> Route Planner</h3>
                <div class="route-planner">
                    <div class="route-input-group">
                        <div class="route-input">
                            <i class="fas fa-circle"></i>
                            <input type="text" id="route-source" placeholder="Start node (e.g., 0)">
                        </div>
                        <div class="route-input">
                            <i class="fas fa-map-marker-alt"></i>
                            <input type="text" id="route-target" placeholder="End node (e.g., 100)">
                        </div>
                    </div>
                    <button class="btn btn-route" id="btn-find-route">
                        <i class="fas fa-directions"></i> Find Route
                    </button>
                    <button class="btn btn-secondary" id="btn-clear-route">
                        <i class="fas fa-times"></i> Clear Route
                    </button>
                    <div class="route-info" id="route-info">
                        <div class="route-info-row">
                            <span class="label">Distance</span>
                            <span class="value" id="route-distance">--</span>
                        </div>
                        <div class="route-info-row">
                            <span class="label">Travel Time</span>
                            <span class="value" id="route-time">--</span>
                        </div>
                        <div class="route-info-row">
                            <span class="label">Hops</span>
                            <span class="value" id="route-hops">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Time Simulation (NEW!) -->
            <div class="panel">
                <h3><i class="fas fa-clock"></i> Time Simulation</h3>
                <div class="time-slider-container">
                    <div class="time-display">
                        <span class="current-time" id="current-time">08:00 AM</span>
                        <span class="time-period rush" id="time-period">üöó Morning Rush</span>
                    </div>
                    <input type="range" class="time-slider" id="time-slider" min="0" max="23" value="8">
                    <div class="time-labels">
                        <span>12 AM</span>
                        <span>6 AM</span>
                        <span>12 PM</span>
                        <span>6 PM</span>
                        <span>11 PM</span>
                    </div>
                    <div class="time-quick-btns">
                        <button class="time-quick-btn" data-hour="7">üåÖ 7AM</button>
                        <button class="time-quick-btn active" data-hour="9">üöó 9AM</button>
                        <button class="time-quick-btn" data-hour="13">‚òÄÔ∏è 1PM</button>
                        <button class="time-quick-btn" data-hour="18">üåÜ 6PM</button>
                        <button class="time-quick-btn" data-hour="22">üåô 10PM</button>
                    </div>
                </div>
            </div>

            <!-- Road Closure -->
            <div class="panel">
                <h3><i class="fas fa-road"></i> Road Closure Test</h3>
                <p class="hint">Click edges on the map to close/open roads</p>
                <div class="closed-roads-list" id="closed-roads-list">
                    <p class="empty-message">No roads closed</p>
                </div>
                <div class="control-group">
                    <label for="random-road-count">Number of Random Roads</label>
                    <input type="number" id="random-road-count" class="input-field" 
                           value="1" min="1" max="100" step="1" 
                           placeholder="Enter count (1-100)">
                </div>
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <button class="btn btn-warning" id="btn-random-close" style="flex: 1;">
                        <i class="fas fa-random"></i> Random Block
                    </button>
                    <button class="btn btn-info" id="btn-random-open" style="flex: 1;">
                        <i class="fas fa-random"></i> Random Open
                    </button>
                </div>
                <button class="btn btn-danger" id="btn-clear-closures">
                    <i class="fas fa-trash"></i> Clear All
                </button>
            </div>

            <!-- Removed Nodes (NEW!) -->
            <div class="panel">
                <h3><i class="fas fa-ban"></i> Removed Nodes</h3>
                <p class="hint">Click on nodes to remove/restore them</p>
                <div class="removed-nodes-list" id="removed-nodes-list">
                    <p class="empty-message">No nodes removed</p>
                </div>
            </div>

            <!-- Statistics -->
            <div class="panel">
                <h3><i class="fas fa-chart-bar"></i> Traffic Statistics</h3>
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Avg Density</div>
                        <div class="stat-value" id="stat-mean">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Max Density</div>
                        <div class="stat-value" id="stat-max">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Road Density</div>
                        <div class="stat-value" id="stat-road">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Metro Density</div>
                        <div class="stat-value" id="stat-metro">--</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Map Container -->
        <main class="map-container">
            <div id="map"></div>
            
            <!-- Map Legend -->
            <div class="map-legend">
                <h4>üó∫Ô∏è Legend</h4>
                <div class="legend-section">
                    <strong>Transport</strong>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #3498db;"></span>
                        <span>Road</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #FF0000; height: 4px;"></span>
                        <span>üî¥ Red Line (Metro)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #0000FF; height: 4px;"></span>
                        <span>üîµ Blue Line (Metro)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #00FF00; height: 4px;"></span>
                        <span>üü¢ Green Line (Metro)</span>
                    </div>
                </div>
                <div class="legend-section">
                    <strong>Amenities</strong>
                    <div class="legend-item">
                        <span class="legend-emoji">üè•</span>
                        <span>Hospital</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-emoji">üå≥</span>
                        <span>Park</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-emoji">üè´</span>
                        <span>School</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-emoji">üöá</span>
                        <span>Metro Station</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-emoji">üõí</span>
                        <span>Mall</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-emoji">üè≠</span>
                        <span>Factory</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-emoji">üè¢</span>
                        <span>Office</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-emoji">üì¶</span>
                        <span>Warehouse</span>
                    </div>
                </div>
                <div class="legend-section">
                    <strong>Congestion Level</strong>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #c0392b;"></span>
                        <span>Very High (80-100%)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #e67e22;"></span>
                        <span>High (60-80%)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #f1c40f;"></span>
                        <span>Medium (40-60%)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #2ecc71;"></span>
                        <span>Low (20-40%)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #1e8449;"></span>
                        <span>Very Low (0-20%)</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #ff69b4; border: 2px dashed #ff69b4;"></span>
                        <span>üö´ Blocked Road</span>
                    </div>
                </div>
            </div>

            <!-- Info Panel -->
            <div class="info-panel" id="info-panel">
                <button class="close-btn" id="close-info">&times;</button>
                <h4 id="info-title">Node Info</h4>
                <div id="info-content"></div>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <p id="loading-text">Loading...</p>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="app.js?v=2.0"></script>
</body>
</html>
